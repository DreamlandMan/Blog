**熔断，降级，限流**：

- 限流：限制并发的请求访问量，超过阈值则拒绝；
- 降级：服务分优先级，牺牲非核心服务（不可用），保证核心服务稳定；从整体负荷考虑；
- 熔断：依赖的下游服务故障触发熔断，避免引发本系统崩溃；系统自动执行和恢复

#### 创建spring-cloud-consumer-hystrix-dashboard模块

- pom.xml依赖

  ```xml
  <dependencies>
  <!--        dashboard-->
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-starter-hystrix-dashboard</artifactId>
              <version>1.4.6.RELEASE</version>
          </dependency>
  <!--        hystrix-->
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-starter-hystrix</artifactId>
              <version>1.4.6.RELEASE</version>
          </dependency>
  
          <!--Ribbon-->
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-starter-ribbon</artifactId>
              <version>1.4.6.RELEASE</version>
          </dependency>
          <!--Eureka: Ribbon需要从Eureka服务中心获取要拿什么-->
          <dependency>
              <groupId>org.springframework.cloud</groupId>
              <artifactId>spring-cloud-starter-eureka</artifactId>
              <version>1.4.6.RELEASE</version>
          </dependency>
  
          <dependency>
              <groupId>com.zi</groupId>
              <artifactId>spring-cloud-api</artifactId>
              <version>1.0-SNAPSHOT</version>
          </dependency>
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-web</artifactId>
          </dependency>
      </dependencies>
  ```

- 这个客户端访问的服务端必须要有监控信息的依赖

  ```xml
  <!--actuator完善监控信息-->
  <dependency>
  	<groupId>org.springframework.boot</groupId>
  	<artifactId>spring-boot-starter-actuator</artifactId>
  </dependency>
  ```

- 编写application.yml

  ```yml
  server:
    port: 9001
  ```

- 编写启动类

  ```java
  @SpringBootApplication
  @EnableHystrixDashboard //开启监控
  public class DeptConsumerDashboard {
      public static void main(String[] args) {
          SpringApplication.run(DeptConsumerDashboard.class,args);
      }
  }
  
  ```

- 访问http://localhost:9001/hystrix

- 给spring-provider-dept-hystrix-8001模块下的主启动类添加如下代码,添加监控，模块必须要有hystrix依赖

  ```java
  //启动类
  @SpringBootApplication
  @EnableEurekaClient //它会在服务启动后自动注册到eureka
  @EnableDiscoveryClient //服务发现
  @EnableCircuitBreaker //添加对熔断的支持
  public class DeptProviderHystrix_8001 {
      public static void main(String[] args) {
          SpringApplication.run(DeptProviderHystrix_8001.class,args);
      }
  
      //    增加一个servlet
      //原来写在这里也会扫描到啊
      //SpringBootApplication注解中有SpringBootConfiguration注解，SpringBootConfiguration注解中有Configuration注解，所以这里写bean也能被扫描到
      @Bean
      public ServletRegistrationBean hystrixMetricsStreamServlet(){
          ServletRegistrationBean registrationBean = new ServletRegistrationBean(new HystrixMetricsStreamServlet());
          registrationBean.addUrlMappings("/actuator/hystrix.stream");
          return registrationBean;
      }
  }
  ```

- 访问：http://localhost:9001/hystrix

  ![在这里插入图片描述](hystrix8.png)

- 进入监控页面，服务IP:服务端口/actuator/hystrix.stream：

  ![在这里插入图片描述](hystrix9.png)

- 效果如下图，每次请求被监控的服务都会有变化：

  ![在这里插入图片描述](hystrix10.png)

  ![在这里插入图片描述](hystrix11.png)

- 那个圆的大小颜色和心电图跟服务访问频率、流量压力有关，这个圈绿色表示安全，红色表示危险，绿<黄<橙<红