#### 小案例

- 本地新建config-dept.yml和config-eureka.yml并提交到码云仓库

  - config-eureka.yml，配置从spring-cloud-eureka-7001模块拷的

    ```yml
    spring:
      profiles:
        active: dev
    
    ---
    server:
      port: 7001
    spring:
      profiles: dev
      application: 
      	name: spring-cloud-config-eureka
    #Eureka配置
    eureka:
      instance:
        hostname: eureka7001 #Eureka服务端的实例名称
      client:
        register-with-eureka: false #表示eureka是否向eureka注册中心注册自己
        fetch-registry: false #如果为false，表示自己为注册中心
        service-url: #如果defaultZone不知道怎么配，那就Ctrl点击service-url，找到EurekaClientConfigBean构造方法
          #      单机
          #      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ #服务注册到哪里去
          #      集群
          defaultZone: http://eureka7002:7002/eureka/,http://eureka7003:7003/eureka/
    
    ---
    server:
      port: 7001
    spring:
      profiles: test
      application:
      	name: spring-cloud-config-eureka
    #Eureka配置
    eureka:
      instance:
        hostname: eureka7001 #Eureka服务端的实例名称
      client:
        register-with-eureka: false #表示eureka是否向eureka注册中心注册自己
        fetch-registry: false #如果为false，表示自己为注册中心
        service-url: #如果defaultZone不知道怎么配，那就Ctrl点击service-url，找到EurekaClientConfigBean构造方法
          #      单机
          #      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka/ #服务注册到哪里去
          #      集群
          defaultZone: http://eureka7002:7002/eureka/,http://eureka7003:7003/eureka/
    ```

  - config-dept.yml，配置从spring-cloud-provider-8001模块拷的

    ```yml
    spring:
      profiles:
        active: dev
    
    ---
    server:
      port: 8001
    
    #mybatis配置
    mybatis:
      type-aliases-package: com.zi.springcloud.pojo
      config-location: classpath:mybatis/mybatis-config.xml
      mapper-locations: classpath:mybatis/mapper/*.xml
    #  configuration:
    #    map-underscore-to-camel-case: true #  驼峰命名
    
    #Spring配置
    spring:
      profiles: dev
      application:
        name: spring-cloud-config-provider #    起个名字
      datasource:
        #    type: com.alibaba.druid.pool.DruidDataSource #数据源
        #    driver-class-name: org.gjt.mm.mysql.Driver #启动器
        driver-class-name: com.mysql.jdbc.Driver #druid用不了的话就换回这个吧
        url: jdbc:mysql://localhost:3306/springcloud?characterEncoding=UTF-8&useUnicode=true&useSSL=true&serverTimezone=UTC
        username: root
        password: root
    
    #Eureka配置
    eureka:
      client:
        service-url:
          #      单机
          #      defaultZone: http://localhost:7001/eureka/
          #      集群
          defaultZone: http://eureka7001:7001/eureka/,http://eureka7002:7002/eureka/,http://eureka7003:7003/eureka/
      instance:
        instance-id: spring-cloud-dept-8001 #可以修改eureka监控中心DS Replicas面板的Status默认描述信息
    
    #info配置
    info:
      app.name: zi-spring-cloud
    
    
    ---
    server:
      port: 8001
    
    #mybatis配置
    mybatis:
      type-aliases-package: com.zi.springcloud.pojo
      config-location: classpath:mybatis/mybatis-config.xml
      mapper-locations: classpath:mybatis/mapper/*.xml
    #  configuration:
    #    map-underscore-to-camel-case: true #  驼峰命名
    
    #Spring配置
    spring:
      profiles: test
      application:
        name: spring-cloud-config-provider #    起个名字
      datasource:
        #    type: com.alibaba.druid.pool.DruidDataSource #数据源
        #    driver-class-name: org.gjt.mm.mysql.Driver #启动器
        driver-class-name: com.mysql.jdbc.Driver #druid用不了的话就换回这个吧
        url: jdbc:mysql://localhost:3306/springcloudclone?characterEncoding=UTF-8&useUnicode=true&useSSL=true&serverTimezone=UTC
        username: root
        password: root
    
    #Eureka配置
    eureka:
      client:
        service-url:
          #      单机
          #      defaultZone: http://localhost:7001/eureka/
          #      集群
          defaultZone: http://eureka7001:7001/eureka/,http://eureka7002:7002/eureka/,http://eureka7003:7003/eureka/
      instance:
        instance-id: spring-cloud-dept-8001 #可以修改eureka监控中心DS Replicas面板的Status默认描述信息
    
    #info配置
    info:
      app.name: zi-spring-cloud
    ```

- 创建spring-cloud-config-eureka-7001模块

  - 把spring-cloud-eureka-7001的java目录的com包整个复制过来

  - pom.xml依赖，在spring-cloud-eureka-7001模块的依赖基础上加上spring-cloud-starter-config依赖

    ```xml
    <!--导包~-->
    <dependencies>
        <!--config-->
        <!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-start -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-config</artifactId>
            <version>2.1.1.RELEASE</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server -->
        <!--导入Eureka Server依赖-->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-eureka-server</artifactId>
            <version>1.4.6.RELEASE</version>
        </dependency>
        <!--热部署工具-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
        </dependency>
    </dependencies>
    ```

  - 创建application.yml和bootstrap.yml

    - bootstrap.yml

      ```yml
      spring:
        cloud:
          config:
            name: config-eureka #请求的yml资源文件
            label: master #请求分支
            profile: dev #请求生产环境
            uri: http://localhost:3344 #服务端地址
      ```

    - application.yml

      ```yml
      spring:
        application:
          name: spring-cloud-config-eureka-7001
      ```

  - 运行服务端启动类，再运行spring-cloud-config-eureka-7001客户端启动类

  - 访问http://localhost:7001/看看能不能跳转eureka页面

- 同样的步骤创建spring-cloud-config-provider-8001模块

  - 导入pom依赖，在spring-cloud-provider-8001模块的依赖上再加上spring-cloud-starter-config依赖
  
    ```xml
    <!--config-->
    <!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-start -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-config</artifactId>
        <version>2.1.1.RELEASE</version>
    </dependency>
    ```
  
  - 把spring-cloud-provider-8001模块的整个main文件夹复制过来
  
  - 创建application.yml和bootstrap.yml，bootstrap.yml把spring.cloud.config.name值改成config-dept，application.yml的spring.application.name值改成spring-cloud-cloud-provider
  
  - 运行服务端启动类，再运行spring-cloud-config-eureka-7001客户端启动类，再运行spring-cloud-config-provider-8001启动类
  
  

