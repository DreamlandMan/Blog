#### Feign简介

- Feign是声明式Web Service客户端，它让微服务之间的调用变得更简单，类似controller调用service。SpringCloud集成了Ribbon和Eureka，可以使用Feigin提供负载均衡的http客户端
- **只需要创建一个接口，然后添加注解即可~**
- Feign，主要是社区版，大家都习惯面向接口编程。这个是很多开发人员的规范。调用微服务访问两种方法
  1. 微服务名字 【ribbon】
  2. 接口和注解 【feign】

#### **Feign能干什么？**

- Feign旨在使编写Java Http客户端变得更容易
- 前面在使用**Ribbon** + **RestTemplate**时，利用**RestTemplate**对Http请求的封装处理，形成了一套模板化的调用方法。但是在实际开发中，由于对服务依赖的调用可能不止一处，往往一个接口会被多处调用，所以通常都会针对每个微服务自行封装一个客户端类来包装这些依赖服务的调用。所以，**Feign**在此基础上做了进一步的封装，由他来帮助我们定义和实现依赖服务接口的定义，**在Feign的实现下，我们只需要创建一个接口并使用注解的方式来配置它 (类似以前Dao接口上标注Mapper注解，现在是一个微服务接口上面标注一个Feign注解)**，即可完成对服务提供方的接口绑定，简化了使用Spring Cloud Ribbon 时，自动封装服务调用客户端的开发量。
- 让代码可读性更强了，但是加了一层性能难免要低一点点

#### **Feign默认集成了Ribbon**

- 利用**Ribbon**维护了MicroServiceCloud-Dept的服务列表信息，并且通过轮询实现了客户端的负载均衡，而与**Ribbon**不同的是，通过**Feign**只需要定义服务绑定接口且以声明式的方法，优雅而简单的实现了服务调用。

#### Feign的使用步骤

- 创建springcloud-consumer-dept-feign模块，里面代码及pom依赖和spring-cloud-consumer-80一样

  - 删掉启动类的自定义Ribbon算法加载注解，不删也可以，Feign集成了Ribbon，可以使用Ribbon的负载均衡算法

  - 修改yml文件的端口

  - pom中添加Feign依赖

    ```xml
    <!--Feign的依赖-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-feign</artifactId>
        <version>1.4.6.RELEASE</version>
    </dependency>
    ```

  - 在启动类上加上EnableFeignClients注解

    ```java
    @SpringBootApplication
    @EnableEurekaClient
    @EnableFeignClients(basePackages = {"com.zi.springcloud"}) //本模块引入了api模块，启动类注解可以扫描到api模块的包
    //@ComponentScan("com.zi.springcloud") //视频说要跟EnableFeignClients注解一起加上，但是不加好像也可以，SpringBootApplication注解内置了
    public class FeignConsumer {
        public static void main(String[] args) {
            SpringApplication.run(FeignConsumer.class,args);
        }
    }
    ```

- 改造springcloud-api模块

  - pom中添加Feign依赖

    ```xml
    <!--Feign的依赖-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-feign</artifactId>
        <version>1.4.6.RELEASE</version>
    </dependency>
    ```

  - 在pojo包同级创建service包，里面创建service接口

    ```java
    @Component
    @FeignClient(name = "SPRING-CLOUD-PROVIDER", fallbackFactory = DeptClientServiceCallbackFactory.class)
    public interface DeptClientService {
        //这时生产者的接口
        @GetMapping("/dept/query{id}")
        Dept queryById(@PathVariable("id") Long id);
    
        @GetMapping("/dept/queryAll")
        List<Dept> queryAll();
    
        @GetMapping("/dept/add")
        boolean add(Dept dept);
    }
    ```
  
  - 改造springcloud-consumer-dept-feign模块的控制器，feign会根据service方法的RequesMapping注解调用生产者的controller方法
  
    ```java
    @RestController
    public class DeptConsumerController {
    
        @Autowired
        DeptClientService service;
    
        @RequestMapping("/consumer/get{id}")
        public Dept get(@PathVariable("id") Long id){
            return service.queryById(id);
        }
        @RequestMapping("/consumer/add")
        public Boolean add(Dept dept){
            return service.add(dept);
        }
        @RequestMapping("/consumer/getAll")
        public List<Dept> getAll(){
            return service.queryAll();
        }
    }
    ```
  
    