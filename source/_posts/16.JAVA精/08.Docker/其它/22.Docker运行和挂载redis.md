# 怎么在docker容器中成功启动redis并进入

首先需要通过docker搜索与redis有关的镜像源

```
docker search redis
```

接着我们通过Docker下载Redis镜像源

```
docker pull redis
```

这里没有设置版本好就会默认下载latest的镜像源。

```
[root@localhost ~]# docker images
REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE
docker.io/tomcat          latest              aeea3708743f        9 days ago          529 MB
docker.io/rabbitmq        latest              2b5cda43d345        2 weeks ago         151 MB
docker.io/elasticsearch   7.6.0               5d2812e0e41c        2 weeks ago         790 MB
docker.io/redis           latest              44d36d2c2374        2 weeks ago         98.2 MB
docker.io/mysql           latest              791b6e40940c        2 weeks ago         465 MB
[root@localhost ~]#
```

接着创建并启动Redis容器

首先启动Docker

```
[root@localhost ~]# systemctl start docker
```

在Docker中启动Redis

这里我们没有设置容器的别名，-d代表后台启动。

```
[root@localhost ~]# docker run -d redis
da45019bf760304a66c3dd96b8847a50eddd8c73ff77cd3b3f37a46d7f016834
```

也可以这样启动Redis，其中-p代表端口映射，将容器中的6379映射到运行Docker机器中的6379端口，--name表示自定义容器名

```
[root@localhost ~]# docker run -d -p 6379:6379   --name="myredis"  redis
249dd65794b32310dea5e094f41df845d971b623382ddc1179c404402f576750
[root@localhost ~]#
```

（学习视频分享：redis视频教程）

进入Redis终端

```
docker exec ：在运行的容器中执行命令
# 语法
docker exec [OPTIONS] CONTAINER COMMAND [ARG...]
# OPTIONS说明：
-d :分离模式: 在后台运行
-i :即使没有附加也保持STDIN 打开
-t :分配一个伪终端
```

而Docker中的容器ID可以用docker -ps来查看

```
[root@localhost ~]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
249dd65794b3        redis               "docker-entrypoint..."   3 minutes ago       Up 3 minutes        0.0.0.0:6379->6379/tcp   myredis
da45019bf760        redis               "docker-entrypoint..."   18 minutes ago      Up 18 minutes       6379/tcp                 naughty_pasteur
[root@localhost ~]#
```

redis-cli表示运行一个redis客户端。

```
[root@localhost ~]# docker exec -it da45019bf760 redis-cli
127.0.0.1:6379> 
127.0.0.1:6379> set msg "Hello World Redis"
OK
127.0.0.1:6379> get msg
"Hello World Redis"
127.0.0.1:6379>
```



# 使用docker安装redis，挂载外部配置和数据

## 普通安装

1.拉取镜像，redis:4.0

```
docker pull redis:4.0
```

2.创建redis容器名"redistest1"，并开启持久化

```
docker run -d -p 6379:6379 --name redistest1 redis:4.0 redis-server --appendonly yes
```

参数说明：

--appendonly yes：开启持久化

## 挂载外部配置和数据安装

1.创建目录和配置文件redis.conf

```
mkdir /docker
mkdir /docker/redis
mkdir /docker/redis/conf
mkdir /docker/redis/data

创建redis.conf配置文件
touch /docker/redis/conf/redis.conf

redis.conf文件内容自行添加：
切记注释掉：#daemonize yes 否则无法启动容器
重要话说三遍：注释掉#daemonize yes，注释掉#daemonize yes，注释掉#daemonize yes
```

2.创建启动容器，加载配置文件并持久化数据

```
docker run -d --privileged=true -p 6379:6379 -v /docker/redis/conf/redis.conf:/etc/redis/redis.conf -v /docker/redis/data:/data --name redistest2 redis:4.0 redis-server /etc/redis/redis.conf --appendonly yes
```

参数说明：

```
--privileged=true：容器内的root拥有真正root权限，否则容器内root只是外部普通用户权限

-v /docker/redis/conf/redis.conf:/etc/redis/redis.conf：映射配置文件

-v /docker/redis/data:/data：映射数据目录

redis-server /etc/redis/redis.conf：指定配置文件启动redis-server进程

--appendonly yes：开启数据持久化
```

