1、首先安装好 Docker，不知道怎么安装的可以看下 [CentOS7安装Docker初体验](https://www.itwxe.com/posts/ca1638ad/) 。

2、下载 MySQL5.7 镜像。

```bash
docker pull mysql:5.7
```

3、创建容器并挂载数据。

```bash
docker run -d --restart=always --name mysql01 \
-v /data/mysql/data:/var/lib/mysql \
-v /data/mysql/conf:/etc/mysql \
-v /data/mysql/log:/var/log/mysql \
-p 3306:3306 \
-e TZ=Asia/Shanghai \
-e MYSQL_ROOT_PASSWORD=root \
mysql:5.7 \
--character-set-server=utf8mb4 \
--collation-server=utf8mb4_general_ci
```

参数说明：

```bash
--restart=always 没有这个参数，容器一启动就会关闭
-v /data/mysql/data:/var/lib/mysql：将数据文件夹挂载到主机
-v /data/mysql/conf:/etc/mysql：将配置文件夹挂在到主机，可以在宿主机放一份自定义 my.cnf文件，那么容器就会按自定义配置启动
-v /data/mysql/log:/var/log/mysql：将日志文件夹挂载到主机
-p 3306:3306：将容器的3306端口映射到主机的3306端口
-e MYSQL_ROOT_PASSWORD=root：初始化root用户的密码
--character-set-server=utf8mb4：设置字符集
--collation-server=utf8mb4_general_ci：排序方式

这些参数不要写错了，顺序也是，否则启动后进入容器会报错Error response from daemon: Container 3f6f50be7d0582d5763676a5a2a9ac79628d3f2898b8143a2db5605f2217017a is restarting, wait until the container is running
```

4、进入 MySQL 容器内部。

```bash
docker exec -it mysql /bin/bash
```

5、登录 MySQL。

```sql
#输入命令，然后会提示输入密码，密码输入是不显示的
mysql -uroot -p
```

6、查看字符集是否生效。

```sql
show variables like 'character_set_%';
```

## 二、挂载是否生效

1、上传备份 sql 到宿主机，复制宿主机备份 sql 到容器。

```bash
docker cp /data/sunny.sql mysql01:/
```

2、进入 mysql 容器内部，导入sql。

```bash
docker exec -it mysql /bin/bash

mysql -uroot -p123456

create database sunny;
use sunny;
source /sunny.sql;
```

3、数据导入成功可以查询后，删除容器，并重新用命令创建容器，查看数据存在。

```bash
docker stop mysql01 && docker rm mysql01
```

4、使用上面的命令重新创建容器，查看数据是否正常

- 可以看到数据正常挂载查询，此处演示的数据正常挂载保存宿主机。
- 注意：
  - 如果重新创建容器设置root用户密码不会生效，因为之前挂载的主机目录中，mysql库的user表的root用户密码已经设置过了，创建容器后会覆盖设置的密码
  - 可以进入容器后，通过之前的密码进入mysql控制台，使用`SET PASSWORD FOR 'root'@'localhost' = PASSWORD('你要设置的密码');`设置新密码
  - 但是远程连接的密码还是123456，因为我们只修改了主机的root密码，需要执行`GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'root' WITH GRANT OPTION;`，将所有主机访问root的密码都设置为root。然后执行`FLUSH PRIVILEGES;`命令刷新权限。

# Docker容器内mysql无法输入中文

使用`docker exec -it 容器名 env LANG=C.UTF-8 /bin/bash`命令进入容器