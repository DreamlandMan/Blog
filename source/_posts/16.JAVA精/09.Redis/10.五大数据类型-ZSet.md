#### Zset（有序集合）

- 不同的是每个元素都会关联一个double类型的分数（score）。redis正是**通过分数**来为集合中的成员进行**从小到大的排序**，正常查询不排序，ZREVRANGE命令才排序。

- score相同：按**字典顺序**排序

- 有序集合的**成员是唯一的**,但**分数(score)可以重复**。

  |                        命令                         |                             描述                             |                           追加描述                           |
  | :-------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
  |     **ZAdd key score member1 [score2 member2]**     | 向有序集合**添加**一个或多个成员，或者**更新**已存在成员的**分数** |                                                              |
  |                    **ZCard key**                    |                   获取有序集合的**成员数**                   |                                                              |
  |               **ZCount key min max**                |        计算在有序集合中**指定score区间**的**成员数**         |             区间：min-max，半开区间，含头不含尾              |
  |              **ZIncrBy key n member**               |        有序集合中对指定成员member的**分数加**上增量 n        |                                                              |
  |                **ZScore key member**                |                返回有序集中，成员的**分数值**                |                                                              |
  |                **ZRank key member**                 |            返回有序集合中指定成员member的**索引**            |                                                              |
  |              **ZRange key start end**               |    通过**索引**区间返回有序集合成**指定区间**内的**成员**    |     区间：start-end，闭区间，含头含尾。0到-1获取所有元素     |
  |             **ZRangeByLex key min max**             |                返回指定**字典区间**的**成员**                | ZRANGEBYLEX testset - +，返回所有成员*<br />ZRANGEBYLEX num [apple (java ，显示 [apple,java)字典区间的成员，不知道为什么显示(empty array) |
  |            **ZRangeByScore key min max**            | 返回有序集合指定**分数**区间内的成员-inf 和 +inf分别表示最小最大值，只支持**开区间** |            ZRANGEBYSCORE num  -inf +inf，查询所有            |
  |              **ZLexCount key min max**              |        在有序集合中计算指定**字典区间**内成员**数量**        |                                                              |
  |          **ZRem key member1 [member2..]**           |               **移除**有序集合中一个/多个成员                |                                                              |
  |           **ZRemRangeByLex key min max**            |        **移除**有序集合中给定的**字典区间**的所有成员        |                                                              |
  |         **ZRemRangeByRank key start stop**          |        **移除**有序集合中给定的**排名区间**的所有成员        |                    排名和索引是同一个东西                    |
  |          **ZRemRangeByScore key min max**           |        **移除**有序集合中给定的**分数区间**的所有成员        |                                                              |
  |             **ZRevRange key start end**             | 将所有元素按**分数从高到低**排序，然后按指定**索引区间**返回元素 |                   区间：start-end，闭区间                    |
  |          **ZRevRangeByScore key max min**           | 将所有元素按**分数从高到低**排序，然后按指定**分数区间**返回元素 |                                                              |
  |           **ZRevRangeByLex key max min**            |   将所有元素按字典**倒序**，然后按指定**字典区间**返回元素   | ZREVRANGEBYLEX num + -，按字典倒序获取所有元素，- +会输出(empty array) |
  |               **ZRevRank key member**               | 将所有元素按**分数从高到低**排序，然后返回指定元素的**排名** |                                                              |
  | **ZInterStore destination numkeys key1 [key2 ..]**  | 计算给定的一个或多个有序集的**交集**并将结果集**存储在新的有序集合**destination中，numkeys：参与运算的集合数。将**score相加**作为结果的score |         参与运算的key只有一个的话，可以达到复制效果          |
  |  **ZUnionStore destination numkeys key1 [key2..]**  | 计算给定的一个或多个有序集的**并集**并将结果集**存储在新的有序集合**destination中，numkeys：表示参与运算的集合数，取各在集合中**最小的score**作为新score |                                                              |
  | **ZScan key cursor [MATCH pattern\] [COUNT count]** |        迭代有序集合中的元素（包括元素成员和元素分值）        |                                                              |
  |                     withscores                      | 返回多个元素的命令后面可以加上withscores，返回元素时会**附加其分数** |                                                              |
  |                   limit start end                   | 返回多个元素的命令后面可以加上limit命令，只**返回指定部分**  | ZRANGEBYSCORE num  -inf +inf limit 2 3，获取所有元素，返回下标2、3、4的元素 |

应用案例：

- set排序 存储班级成绩表 工资表排序！
- 普通消息，1.重要消息 2.带权重进行判断
- 排行榜应用实现，取Top N测试

实例

```shell
-------------------ZADD--ZCARD--ZCOUNT--------------
127.0.0.1:6379> ZADD myzset 1 m1 2 m2 3 m3 # 向有序集合myzset中添加成员m1 score=1 以及成员m2 score=2..
(integer) 2
127.0.0.1:6379> ZCARD myzset # 获取有序集合的成员数
(integer) 2
127.0.0.1:6379> ZCOUNT myzset 0 1 # 获取score在 [0,1]区间的成员数量
(integer) 1
127.0.0.1:6379> ZCOUNT myzset 0 2
(integer) 2

----------------ZINCRBY--ZSCORE--------------------------
127.0.0.1:6379> ZINCRBY myzset 5 m2 # 将成员m2的score +5
"7"
127.0.0.1:6379> ZSCORE myzset m1 # 获取成员m1的score
"1"
127.0.0.1:6379> ZSCORE myzset m2
"7"

--------------ZRANK--ZRANGE-----------------------------------
127.0.0.1:6379> ZRANK myzset m1 # 获取成员m1的索引，索引按照score排序，score相同索引值按字典顺序顺序增加
(integer) 0
127.0.0.1:6379> ZRANK myzset m2
(integer) 2
127.0.0.1:6379> ZRANGE myzset 0 1 # 获取索引在 0~1的成员
1) "m1"
2) "m3"
127.0.0.1:6379> ZRANGE myzset 0 -1 # 获取全部成员
1) "m1"
2) "m3"
3) "m2"

#testset=>{abc,add,amaze,apple,back,java,redis} score均为0
------------------ZRANGEBYLEX---------------------------------
127.0.0.1:6379> ZRANGEBYLEX testset - + # 返回所有成员
1) "abc"
2) "add"
3) "amaze"
4) "apple"
5) "back"
6) "java"
7) "redis"
127.0.0.1:6379> ZRANGEBYLEX testset - + LIMIT 0 3 # 分页 按索引显示查询结果的 0,1,2条记录
1) "abc"
2) "add"
3) "amaze"
127.0.0.1:6379> ZRANGEBYLEX testset - + LIMIT 3 3 # 显示 3,4,5条记录
1) "apple"
2) "back"
3) "java"
127.0.0.1:6379> ZRANGEBYLEX testset (- [apple # 显示 (-,apple] 区间内的成员
1) "abc"
2) "add"
3) "amaze"
4) "apple"
127.0.0.1:6379> ZRANGEBYLEX testset [apple [java # 显示 [apple,java]字典区间的成员
1) "apple"
2) "back"
3) "java"

-----------------------ZRANGEBYSCORE---------------------
127.0.0.1:6379> ZRANGEBYSCORE myzset 1 10 # 返回score在 [1,10]之间的的成员
1) "m1"
2) "m3"
3) "m2"
127.0.0.1:6379> ZRANGEBYSCORE myzset 1 5
1) "m1"
2) "m3"

--------------------ZLEXCOUNT-----------------------------
127.0.0.1:6379> ZLEXCOUNT testset - +
(integer) 7
127.0.0.1:6379> ZLEXCOUNT testset [apple [java
(integer) 3

------------------ZREM--ZREMRANGEBYLEX--ZREMRANGBYRANK--ZREMRANGEBYSCORE--------------------------------
127.0.0.1:6379> ZREM testset abc # 移除成员abc
(integer) 1
127.0.0.1:6379> ZREMRANGEBYLEX testset [apple [java # 移除字典区间[apple,java]中的所有成员
(integer) 3
127.0.0.1:6379> ZREMRANGEBYRANK testset 0 1 # 移除排名0~1的所有成员
(integer) 2
127.0.0.1:6379> ZREMRANGEBYSCORE myzset 0 3 # 移除score在 [0,3]的成员
(integer) 2


# testset=> {abc,add,apple,amaze,back,java,redis} score均为0
# myzset=> {(m1,1),(m2,2),(m3,3),(m4,4),(m7,7),(m9,9)}
----------------ZREVRANGE--ZREVRANGEBYSCORE--ZREVRANGEBYLEX-----------
127.0.0.1:6379> ZREVRANGE myzset 0 3 # 按score递减排序，然后按索引，返回结果的 0~3
1) "m9"
2) "m7"
3) "m4"
4) "m3"
127.0.0.1:6379> ZREVRANGE myzset 2 4 # 返回排序结果的 索引的2~4
1) "m4"
2) "m3"
3) "m2"
127.0.0.1:6379> ZREVRANGEBYSCORE myzset 6 2 # 按score递减顺序 返回集合中分数在[2,6]之间的成员
1) "m4"
2) "m3"
3) "m2"
127.0.0.1:6379> ZREVRANGEBYLEX testset [java (add # 按字典倒序 返回集合中(add,java]字典区间的成员
1) "java"
2) "back"
3) "apple"
4) "amaze"

-------------------------ZREVRANK------------------------------
127.0.0.1:6379> ZREVRANK myzset m7 # 按score递减顺序，返回成员m7索引
(integer) 1
127.0.0.1:6379> ZREVRANK myzset m2
(integer) 4


# mathscore=>{(xm,90),(xh,95),(xg,87)} 小明、小红、小刚的数学成绩
# enscore=>{(xm,70),(xh,93),(xg,90)} 小明、小红、小刚的英语成绩
-------------------ZINTERSTORE--ZUNIONSTORE-----------------------------------
127.0.0.1:6379> ZINTERSTORE sumscore 2 mathscore enscore # 将mathscore enscore进行合并 结果存放到sumscore
(integer) 3
127.0.0.1:6379> ZRANGE sumscore 0 -1 withscores # 合并后的score是之前集合中所有score的和
1) "xm"
2) "160"
3) "xg"
4) "177"
5) "xh"
6) "188"

127.0.0.1:6379> ZUNIONSTORE lowestscore 2 mathscore enscore AGGREGATE MIN # 取两个集合的成员score最小值作为结果的
(integer) 3
127.0.0.1:6379> ZRANGE lowestscore 0 -1 withscores
1) "xm"
2) "70"
3) "xg"
4) "87"
5) "xh"
6) "93"
```

