### Redis.conf详解

- 启动时，通过配置文件来启动！
- 在查看模式，:wq保存并退出
- 在查看模式，“/”在当前行之后查找，比如/port就是查找这一行下面的第一个port，n查找下一个，N查找上一个

#### 容量单位

- 不区分大小写，G和GB有区别

```shell
# Note on units: when memory size is needed, it is possible to specify
# it in the usual form of 1k 5GB 4M and so forth:
#
# 1k => 1000 bytes
# 1kb => 1024 bytes
# 1m => 1000000 bytes
# 1mb => 1024*1024 bytes
# 1g => 1000000000 bytes
# 1gb => 1024*1024*1024 bytes
#
# units are case insensitive so 1GB 1Gb 1gB are all the same. #大小写不敏感1GB、1Gb、1gb是一样的
```

#### 包含

- 可以把其他的redis.conf配置文件包含在这里，组合成一个

```shell
################################## INCLUDES ###################################

...
#
# include /path/to/local.conf
# include /path/to/other.conf

```

#### 网络配置

```shell
bind 127.0.0.1 #绑定IP

protected-mode no #远程保护模式，默认开启，好像设置了密码就不用开了

port 6379 #端口，最好改一下，防止别人拿来挖矿
```

#### 通用

```shell
################################# GENERAL #####################################

#是否以守护线程运行
daemonize yes

#管理守护进程的，默认是no
supervised no

#如果以后台方式运行就需要指定一个pid文件
pidfile /var/run/redis_6379.pid

#默认16个数据库
databases 16

#是否总显示Logo
always-show-logo yes

```

#### 日志输出

```shell
# Specify the server verbosity level.
# This can be one of:
# debug (a lot of information, useful for development/testing) #开发阶段
# verbose (many rarely useful info, but not a mess like the debug level) #跟debug差不多
# notice (moderately verbose, what you want in production probably) #通知，生产环境
# warning (only very important / critical messages are logged) #警告，一般只打印关键的、非常重要的信息

loglevel notice #日志级别，有debug、verbose、notice、warning四个级别
logfile "" #日志输出文件名，如果为空就是一个标准的输出
```

#### 快照

- 持久化，在规定时间内，执行了多少次操作，就会持久化到文件 .rdb .aof

- 由于Redis是基于内存的数据库，需要将数据由内存持久化到文件中

  持久化方式：RDB、AOF

  ```shell
  #持久化规则，持久化到文件 .rdb	.aof
  #如果900秒内，至少1个key进行了修改，就进行持久化
  save 900 1
  #如果300秒内，至少10个key进行了修改，就进行持久化
  save 300 10
  #如果60秒内，至少10000个key进行了修改，就进行持久化
  save 60 10000
  ```

#### RDB（Redis Databases）文件相关

```shell
#持久化发生错误是否停止工作，默认yes停止工作
stop-writes-on-bgsave-error yes

#是否压缩.rdb文件，需要消耗一些CPU资源
rdbcompression yes

#保存rdb文件时是否校验.rdb文件，如果出错了会自动进行一些修复
rdbchecksum yes

# The filename where to dump the DB
dbfilename dump.rdb

#rdb文件保存的目录
dir ./
```

#### 主从复制，后面再讲

```shell
################################# REPLICATION #################################

# Master-Slave replication. Use slaveof to make a Redis instance a copy of
# another Redis server. A few things to understand ASAP about Redis replication.
```

#### Security安全模块中进行密码设置

```shell
#默认是空的，默认没有密码
#redis客户端可以使用config set requirepass 1234设置密码，config get requirepass获取密码
# requirepass foobared
requirepass root #设置密码为root，设置完redis客户端就没有权限了，要使用命令auth root认证一下，或者开启客户端时加上-a root命令
```

#### 客户端连接相关

```shell
# maxclients 10000 #最大客户端连接数，默认10000
# maxmemory <bytes> #最大内存限制
# maxmemory-policy noeviction #内存达到限制的处理策略
```

- redis 中的**默认**的过期策略是 **volatile-lru** 

- 设置方式（redis客户端命令）

  ```shell
  config set maxmemory-policy volatile-lru 
  ```

- **maxmemory-policy 六种方式**

  - volatile-lru：只对设置了过期时间的key进行LRU（默认值）
  - allkeys-lru ： 删除lru算法的key
  - volatile-random：随机删除即将过期key
  - allkeys-random：随机删除
  - volatile-ttl ： 删除即将过期的
  - noeviction ： 永不过期，直接报一个错

#### AOF（Append Only File）相关部分

```shell
appendonly no #默认不开启AOF，使用RDB方式，在大部分情况下RDB完全够用的

appendfilename "appendonly.aof" #持久化默认文件名

# appendfsync always #每次修改进行同步，消耗性能
appendfsync everysec #每秒执行一次同步,可能会丢失这一秒数据
# appendfsync no #不进行同步，由操作系统进行同步，速度最快
```

