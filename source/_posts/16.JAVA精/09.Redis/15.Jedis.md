#### Jedis

- 使用Java来操作Redis，Jedis是Redis官方推荐使用的Java连接redis的客户端。

- 创建一个maven项目，导入依赖

  ```xml
  <!--导入jredis的包-->
  <dependency>
      <groupId>redis.clients</groupId>
      <artifactId>jedis</artifactId>
      <version>3.2.0</version>
  </dependency>
  <!--fastjson-->
  <dependency>
      <groupId>com.alibaba</groupId>
      <artifactId>fastjson</artifactId>
      <version>1.2.70</version>
  </dependency>
  ```

- 创建一个主函数测试ping命令，redis几大数据类型都可以使用Jedis对象操作

  ```java
  import redis.clients.jedis.Jedis;
  
  public class TestPing {
      public static void main(String[] args) {
          //连接redis，Jedis对象拥有redis大部分命令
          Jedis jedis = new Jedis("8.130.20.77",6379);
          
          //如果设置了连接密码就auth一下，没设置auth会报错
  		//jedis.auth("password");
          
          //ping一下测试连接
          String ping = jedis.ping();
          //连接成功会打印PONG
          System.out.println(ping);
          
          //断开redis连接
          jedis.close();
      }
  }
  ```

  - 报错Failed connecting to host 8.130.20.77:6379
    1. 开放阿里安全组6379
    2. 服务器防火墙开放端口6379，**firewall-cmd --permanent --add-port=6379/tcp**
    3. 重启服务器防火墙，**systemctl restart firewalld.service**
    4. 查看6379端口是否开放成功，**firewall-cmd --query-port=6379/tcp**
    5. 修改redis配置文件**redis.conf**，把**protect mode的值改成no**，默认yes，关掉远程保护
    6. 修改redis配置文件**redis.conf**，**注释掉bind 127.0.0.1**
    7. 重启redis服务，**redis-server myconfig/redis.conf**


#### 事务

- Jedis中的方法（对应redis命令）在Transaction对象都有

```java
public class TestTX {
    public static void main(String[] args) {
        Jedis jedis = new Jedis("39.99.xxx.xx", 6379);

        JSONObject jsonObject = new JSONObject();
        jsonObject.put("hello", "world");
        jsonObject.put("name", "kuangshen");
        
        String result = jsonObject.toJSONString(); //将json对象转换为json字符串
        
        // 开启事务
        Transaction multi = jedis.multi();
        
        //监控key
        // jedis.watch(user1)
        // jedis.watch(user2)
        
        try {
            
            //jedis
            
            //设置键值对，键为user1，值为json字符串
            multi.set("user1", result); 
            multi.set("user2", result);
            
            //int i = 1/0; //错误的代码，报错回滚
            
            // 执行事务
            multi.exec();
            
            //int i = 1/0; //放在这里，会exec后再discard，会报错ERR DISCARD without MULTI
        }catch (Exception e){
            // 如果命令出现异常就放弃事务
            multi.discard();
        } finally {
            //查看命令有没有生效，获取设置的值
            System.out.println(jedis.get("user1"));
            System.out.println(jedis.get("user2"));
            // 关闭连接
            jedis.close();
        }
    }
}
```
